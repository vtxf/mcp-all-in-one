---
name: Release Version
description: 更新版本号、更新修订日志、安装依赖、构建、打标签并发布到npm
category: Release
tags: [release, version, npm, publish]
---

**功能说明**
用于自动完成项目的版本发布流程，包括：
1. 更新package.json中的版本号
2. 在CHANGELOG.md中添加新的版本条目
3. 安装依赖（npm install）
4. 构建项目（npm run build）
5. 创建git tag并push到远程仓库
6. 发布到npm

**使用方法**
```
/release [版本号]
```

**参数说明**
- `[版本号]`: 新的版本号，格式遵循语义化版本规范（如 1.2.4、2.0.0等）
- 如果不提供版本号，系统会显示当前版本号并建议一个新版本号供确认

**执行步骤**
1. 如果未提供版本号：
   - 读取package.json获取当前版本号
   - 根据当前版本号建议下一个版本号（自动递增补丁版本号）
   - 询问用户是否使用建议的版本号或输入自定义版本号
2. 验证版本号格式
3. 检查git工作区是否干净
4. 更新package.json中的版本号
5. 在CHANGELOG.md中添加新版本条目（需要手动编辑具体内容）
6. 运行npm install
7. 运行npm run build
8. 创建git tag（格式：v<版本号>）
9. 推送git commits和tags到远程仓库
10. 发布到npm

**注意事项**
- 执行前请确保已配置好npm发布权限
- 执行前请确保git工作区没有未提交的更改
- 新版本的CHANGELOG内容需要手动编辑完善
- 发布成功后请在GitHub上创建Release

**错误处理规则**
- 如果发布过程中遇到任何问题，立即停止操作
- 常见错误情况包括：
  - npm install 失败（依赖安装问题）
  - npm run build 失败（构建错误）
  - 版本号重复或格式错误
  - git commit 失败（合并冲突或其他git错误）
  - git push 失败（网络问题或权限问题）
  - npm publish 失败（认证问题或包名冲突）
- 遇到错误时，系统会：
  1. 立即停止后续操作
  2. 显示具体的错误信息和错误位置
  3. 提供可能的解决方案建议
  4. 等待用户决定下一步操作
- 用户可以选择：
  - 修复问题后重新执行命令
  - 手动完成剩余步骤
  - 回滚已完成的操作

**示例**
```
/release 1.2.4
/release
```

**交互示例**
```
/release
> 当前版本号: 1.2.3
> 建议版本号: 1.2.4
> 是否使用建议版本号? (y/n): y
> 开始发布流程...
```

**错误处理示例**
```
/release 1.2.4
> 更新版本号... 完成
> 安装依赖... 失败
> ❌ 错误: npm install 执行失败
> 错误信息: ERR! peer dep missing: @types/node@^22.0.0
> 建议解决方案: 检查package.json中的依赖版本配置
> 已停止操作，请决定下一步：
> 1. 修复问题后重新执行 /release
> 2. 手动完成剩余步骤
> 3. 回滚版本号更改
```